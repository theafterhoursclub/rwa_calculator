{
  "version": "1",
  "metadata": {
    "marimo_version": "0.19.4"
  },
  "cells": [
    {
      "id": "Hbol",
      "code_hash": "1d60f109e8634c200eea8d6635e5cffb",
      "outputs": [
        {
          "type": "data",
          "data": {
            "text/plain": ""
          }
        }
      ],
      "console": []
    },
    {
      "id": "MJUe",
      "code_hash": "8743e1f342c44639b468f5d8198645e1",
      "outputs": [
        {
          "type": "data",
          "data": {
            "text/markdown": "<span class=\"markdown prose dark:prose-invert contents\"><h1 id=\"group-crr-b-crr-foundation-irb-f-irb-scenarios\">Group CRR-B: CRR Foundation IRB (F-IRB) Scenarios</h1>\n<span class=\"paragraph\">This workbook calculates expected RWA values for CRR F-IRB scenarios CRR-B1 to CRR-B7.</span>\n<span class=\"paragraph\"><strong>Regulatory Framework:</strong> CRR (Capital Requirements Regulation)\n<strong>Effective:</strong> Until 31 December 2026</span>\n<span class=\"paragraph\"><strong>Key CRR F-IRB Features:</strong></span>\n<ul>\n<li>Bank provides own PD estimates</li>\n<li>\n<span class=\"paragraph\">Supervisory LGD values (Art. 161):</span>\n<ul>\n<li>45% unsecured senior</li>\n<li>75% subordinated</li>\n<li>Reduced LGD for collateralised exposures</li>\n</ul>\n</li>\n<li>Single PD floor: 0.03% for all exposure classes</li>\n<li>Maturity adjustment: 1-5 year floor/cap</li>\n<li>SME supporting factor (0.7619) available</li>\n<li>\n<span class=\"paragraph\"><strong>F-IRB only applies to wholesale exposures</strong> (corporate, institution, sovereign)</span>\n<ul>\n<li>Retail exposures must use A-IRB (with internal LGD) or Standardised Approach</li>\n</ul>\n</li>\n</ul>\n<span class=\"paragraph\"><strong>Key differences from Basel 3.1:</strong></span>\n<ul>\n<li>CRR has single 0.03% PD floor (Basel 3.1 has differentiated floors)</li>\n<li>CRR SME factor available (not in Basel 3.1)</li>\n<li>No output floor under CRR</li>\n</ul></span>"
          }
        }
      ],
      "console": []
    },
    {
      "id": "vblA",
      "code_hash": "04516e1a32cdf002b3382e605962f95c",
      "outputs": [
        {
          "type": "data",
          "data": {
            "text/plain": ""
          }
        }
      ],
      "console": []
    },
    {
      "id": "bkHC",
      "code_hash": "f131532abc82ac6cc8cd2993c0dde1b8",
      "outputs": [
        {
          "type": "data",
          "data": {
            "text/plain": ""
          }
        }
      ],
      "console": []
    },
    {
      "id": "lEQa",
      "code_hash": "91e070b674585ed73a174d1dbc5538bd",
      "outputs": [
        {
          "type": "data",
          "data": {
            "text/markdown": "<span class=\"markdown prose dark:prose-invert contents\"><hr />\n<h2 id=\"scenario-crr-b1-corporate-f-irb-low-pd\">Scenario CRR-B1: Corporate F-IRB - Low PD</h2>\n<span class=\"paragraph\"><strong>Input:</strong> \u00a310m corporate loan, PD 0.10%, 2.5 year maturity\n<strong>Expected:</strong> F-IRB calculation with supervisory LGD 45%</span>\n<span class=\"paragraph\"><strong>CRR Treatment:</strong></span>\n<ul>\n<li>PD floor: 0.03% (CRR Art. 163)</li>\n<li>LGD: 45% supervisory (CRR Art. 161)</li>\n<li>Maturity adjustment applied (CRR Art. 162)</li>\n</ul>\n<span class=\"paragraph\"><strong>Reference:</strong> CRR Art. 153, 161, 162, 163</span></span>"
          }
        }
      ],
      "console": []
    },
    {
      "id": "PKri",
      "code_hash": "7d340c2f230305fe1f24a7a26f63af5d",
      "outputs": [
        {
          "type": "data",
          "data": {
            "text/plain": ""
          }
        }
      ],
      "console": [
        {
          "type": "stream",
          "name": "stdout",
          "text": "CRR-B1: EAD=\u00a325,000,000, PD=0.10%, LGD=45%, MATURITY=2.5, MAT ADJ=1.5883, CORRELATION=0.2341, K=0.0149 RWA=\u00a37,858,308\n",
          "mimetype": "text/plain"
        }
      ]
    },
    {
      "id": "Xref",
      "code_hash": "2c9710c8e862b2f3e855f6f4c1745b52",
      "outputs": [
        {
          "type": "data",
          "data": {
            "text/markdown": "<span class=\"markdown prose dark:prose-invert contents\"><hr />\n<h2 id=\"scenario-crr-b2-corporate-f-irb-high-pd\">Scenario CRR-B2: Corporate F-IRB - High PD</h2>\n<span class=\"paragraph\"><strong>Input:</strong> \u00a35m corporate loan, PD 5.00%, 3 year maturity\n<strong>Expected:</strong> Higher RWA due to increased PD</span>\n<span class=\"paragraph\"><strong>Reference:</strong> CRR Art. 153, 161, 162</span></span>"
          }
        }
      ],
      "console": []
    },
    {
      "id": "SFPL",
      "code_hash": "7f2da8e062c880947ab178e0a7ff74f4",
      "outputs": [
        {
          "type": "data",
          "data": {
            "text/plain": ""
          }
        }
      ],
      "console": [
        {
          "type": "stream",
          "name": "stdout",
          "text": "CRR-B2: EAD=\u00a35,000,000, PD=5.00%, LGD=45%, RWA=\u00a38,259,489\n",
          "mimetype": "text/plain"
        }
      ]
    },
    {
      "id": "BYtC",
      "code_hash": "e973744abad37f00df4d48ea7e06f196",
      "outputs": [
        {
          "type": "data",
          "data": {
            "text/markdown": "<span class=\"markdown prose dark:prose-invert contents\"><hr />\n<h2 id=\"scenario-crr-b3-subordinated-exposure-75-lgd\">Scenario CRR-B3: Subordinated Exposure - 75% LGD</h2>\n<span class=\"paragraph\"><strong>Input:</strong> \u00a32m subordinated loan, PD 1.00%\n<strong>Expected:</strong> Higher LGD (75%) for subordinated claims</span>\n<span class=\"paragraph\"><strong>CRR Treatment (Art. 161):</strong></span>\n<ul>\n<li>Subordinated claims: 75% LGD</li>\n<li>Senior unsecured: 45% LGD</li>\n</ul>\n<span class=\"paragraph\"><strong>Reference:</strong> CRR Art. 153, 161</span></span>"
          }
        }
      ],
      "console": []
    },
    {
      "id": "RGSE",
      "code_hash": "9de060a354f86c42a0c06a2efc67e982",
      "outputs": [
        {
          "type": "data",
          "data": {
            "text/plain": ""
          }
        }
      ],
      "console": [
        {
          "type": "stream",
          "name": "stdout",
          "text": "CRR-B3: EAD=\u00a32,000,000, PD=1.00%, LGD=75%, RWA=\u00a33,934,551\n",
          "mimetype": "text/plain"
        }
      ]
    },
    {
      "id": "Kclp",
      "code_hash": "d7a07400033729789925e104f15311ac",
      "outputs": [
        {
          "type": "data",
          "data": {
            "text/markdown": "<span class=\"markdown prose dark:prose-invert contents\"><hr />\n<h2 id=\"scenario-crr-b4-financial-collateral-reduced-lgd\">Scenario CRR-B4: Financial Collateral - Reduced LGD</h2>\n<span class=\"paragraph\"><strong>Input:</strong> \u00a35m loan with cash collateral covering 50%\n<strong>Expected:</strong> Reduced effective LGD for collateralised portion</span>\n<span class=\"paragraph\"><strong>CRR Treatment (Art. 161):</strong></span>\n<ul>\n<li>Financial collateral (cash): 0% LGD on collateralised portion</li>\n<li>Blended LGD for partially collateralised exposures</li>\n</ul>\n<span class=\"paragraph\"><strong>Reference:</strong> CRR Art. 153, 161, 228</span></span>"
          }
        }
      ],
      "console": []
    },
    {
      "id": "emfo",
      "code_hash": "69e5f77b0c1124051013c52b4a39a4b1",
      "outputs": [
        {
          "type": "data",
          "data": {
            "text/plain": ""
          }
        }
      ],
      "console": [
        {
          "type": "stream",
          "name": "stdout",
          "text": "CRR-B4: EAD=\u00a35,000,000, PD=0.50%, LGD=22.5%, RWA=\u00a31,844,711\n",
          "mimetype": "text/plain"
        }
      ]
    },
    {
      "id": "Hstk",
      "code_hash": "191c5e0d278eff4def3a0e3a7d975367",
      "outputs": [
        {
          "type": "data",
          "data": {
            "text/markdown": "<span class=\"markdown prose dark:prose-invert contents\"><hr />\n<h2 id=\"scenario-crr-b5-sme-corporate-f-irb-with-supporting-factor\">Scenario CRR-B5: SME Corporate F-IRB with Supporting Factor</h2>\n<span class=\"paragraph\"><strong>Input:</strong> \u00a33m SME loan, PD 2.00%, turnover \u00a325m\n<strong>Expected:</strong> F-IRB RWA \u00d7 0.7619 SME factor</span>\n<span class=\"paragraph\"><strong>CRR Treatment:</strong></span>\n<ul>\n<li>SME firm size adjustment in correlation</li>\n<li>SME supporting factor (0.7619) on top</li>\n<li>Combined effect: significant RWA reduction</li>\n</ul>\n<span class=\"paragraph\"><strong>Reference:</strong> CRR Art. 153, 501</span></span>"
          }
        }
      ],
      "console": []
    },
    {
      "id": "nWHF",
      "code_hash": "a1dfeb606e4f44368b48ec67c5411ff4",
      "outputs": [
        {
          "type": "error",
          "ename": "exception",
          "evalue": "apply_sme_supporting_factor() missing 1 required positional argument: 'total_exposure'",
          "traceback": []
        }
      ],
      "console": [
        {
          "type": "stream",
          "name": "stderr",
          "text": "<span class=\"codehilite\"><div class=\"highlight\"><pre><span></span><span class=\"gt\">Traceback (most recent call last):</span>\n  File <span class=\"nb\">&quot;C:\\Users\\philm\\PycharmProjects\\rwa_calculator\\.venv\\Lib\\site-packages\\marimo\\_runtime\\executor.py&quot;</span>, line <span class=\"m\">138</span>, in <span class=\"n\">execute_cell</span>\n<span class=\"w\">    </span><span class=\"n\">exec</span><span class=\"p\">(</span><span class=\"n\">cell</span><span class=\"o\">.</span><span class=\"n\">body</span><span class=\"p\">,</span> <span class=\"n\">glbls</span><span class=\"p\">)</span>\n<span class=\"w\">    </span><span class=\"pm\">~~~~^^^^^^^^^^^^^^^^^^</span>\n  File <span class=\"nb\">&quot;C:\\Users\\philm\\AppData\\Local\\Temp\\marimo_16068\\__marimo__cell_nWHF_.py&quot;</span>, line <span class=\"m\">33</span>, in <span class=\"n\">&lt;module&gt;</span>\n<span class=\"w\">    </span><span class=\"n\">rwa_after_sf_b5</span><span class=\"p\">,</span> <span class=\"n\">sf_applied_b5</span><span class=\"p\">,</span> <span class=\"n\">sf_desc_b5</span> <span class=\"o\">=</span> <span class=\"n\">apply_sme_supporting_factor</span><span class=\"p\">(</span>\n<span class=\"w\">                                                 </span><span class=\"pm\">~~~~~~~~~~~~~~~~~~~~~~~~~~~^</span>\n<span class=\"w\">    </span>    <span class=\"n\">rwa</span><span class=\"o\">=</span><span class=\"n\">rwa_before_sf_b5</span><span class=\"p\">,</span>\n<span class=\"w\">        </span><span class=\"pm\">^^^^^^^^^^^^^^^^^^^^^</span>\n<span class=\"w\">    </span><span class=\"o\">...&lt;</span><span class=\"mi\">2</span> <span class=\"n\">lines</span><span class=\"o\">&gt;...</span>\n<span class=\"w\">    </span>    <span class=\"n\">currency</span><span class=\"o\">=</span><span class=\"s2\">&quot;EUR&quot;</span><span class=\"p\">,</span>\n<span class=\"w\">        </span><span class=\"pm\">^^^^^^^^^^^^^^^</span>\n<span class=\"w\">    </span><span class=\"p\">)</span>\n<span class=\"w\">    </span><span class=\"pm\">^</span>\n<span class=\"gr\">TypeError</span>: <span class=\"n\">apply_sme_supporting_factor() missing 1 required positional argument: &#39;total_exposure&#39;</span>\n</pre></div>\n</span>",
          "mimetype": "application/vnd.marimo+traceback"
        }
      ]
    },
    {
      "id": "iLit",
      "code_hash": "78d09b446cbff2728f450f0f4b33436d",
      "outputs": [
        {
          "type": "data",
          "data": {
            "text/markdown": "<span class=\"markdown prose dark:prose-invert contents\"><hr />\n<h2 id=\"scenario-crr-b6-pd-floor-binding\">Scenario CRR-B6: PD Floor Binding</h2>\n<span class=\"paragraph\"><strong>Input:</strong> \u00a35m loan with very low internal PD estimate (0.01%)\n<strong>Expected:</strong> PD floored to 0.03%</span>\n<span class=\"paragraph\"><strong>CRR Treatment (Art. 163):</strong></span>\n<ul>\n<li>Single PD floor: 0.03% for all non-defaulted exposures</li>\n<li>Unlike Basel 3.1 which has differentiated floors</li>\n</ul>\n<span class=\"paragraph\"><strong>Reference:</strong> CRR Art. 153, 163</span></span>"
          }
        }
      ],
      "console": []
    },
    {
      "id": "ZHCJ",
      "code_hash": "db46cd1d6c36bc18e775b4baf24e31d9",
      "outputs": [
        {
          "type": "data",
          "data": {
            "text/plain": ""
          }
        }
      ],
      "console": [
        {
          "type": "stream",
          "name": "stdout",
          "text": "CRR-B6: EAD=\u00a31,000,000, PD=0.01% -> 0.03%, RWA=\u00a3128,848\n",
          "mimetype": "text/plain"
        }
      ]
    },
    {
      "id": "ROlb",
      "code_hash": "f419cfd9323c82c7c3562ff0752b6955",
      "outputs": [
        {
          "type": "data",
          "data": {
            "text/markdown": "<span class=\"markdown prose dark:prose-invert contents\"><hr />\n<h2 id=\"scenario-crr-b7-long-maturity-exposure-5y-cap\">Scenario CRR-B7: Long Maturity Exposure (5Y Cap)</h2>\n<span class=\"paragraph\"><strong>Input:</strong> \u00a38m loan with 7 year maturity (capped at 5)\n<strong>Expected:</strong> Maturity capped at 5 years</span>\n<span class=\"paragraph\"><strong>CRR Treatment (Art. 162):</strong></span>\n<ul>\n<li>Maturity floor: 1 year</li>\n<li>Maturity cap: 5 years</li>\n</ul>\n<span class=\"paragraph\"><strong>Reference:</strong> CRR Art. 153, 162</span></span>"
          }
        }
      ],
      "console": []
    },
    {
      "id": "qnkX",
      "code_hash": "2a6555a0d3bc86a25b738fbb9df31e87",
      "outputs": [
        {
          "type": "data",
          "data": {
            "text/plain": ""
          }
        }
      ],
      "console": [
        {
          "type": "stream",
          "name": "stdout",
          "text": "CRR-B7: EAD=\u00a38,000,000, Maturity=7.0y -> 5.0y, RWA=\u00a39,841,717\n",
          "mimetype": "text/plain"
        }
      ]
    },
    {
      "id": "TqIu",
      "code_hash": "89c48272e1a5d50da4e7a5e6e0c88769",
      "outputs": [
        {
          "type": "data",
          "data": {
            "text/markdown": "<span class=\"markdown prose dark:prose-invert contents\"><hr />\n<h2 id=\"summary-group-crr-b-f-irb-results\">Summary: Group CRR-B F-IRB Results</h2>\n<span class=\"paragraph\">Key CRR F-IRB observations:</span>\n<ol>\n<li>Single PD floor (0.03%) for all exposure classes</li>\n<li>Supervisory LGD: 45% senior, 75% subordinated</li>\n<li>SME supporting factor (0.7619) available</li>\n<li>Maturity capped at 5 years, floored at 1 year</li>\n<li>\n<span class=\"paragraph\">F-IRB only applies to wholesale exposures (corporate, institution, sovereign)</span>\n<ul>\n<li>Retail must use A-IRB (internal LGD) or Standardised Approach</li>\n</ul>\n</li>\n</ol></span>"
          }
        }
      ],
      "console": []
    },
    {
      "id": "Vxnm",
      "code_hash": "586361bc85a81b11625cafa8968685ed",
      "outputs": [
        {
          "type": "error",
          "ename": "exception",
          "evalue": "An ancestor raised an exception (TypeError): ",
          "traceback": []
        }
      ],
      "console": []
    },
    {
      "id": "DnEU",
      "code_hash": "af0e47828f5eda362949ebfdf3ca3ed6",
      "outputs": [
        {
          "type": "error",
          "ename": "exception",
          "evalue": "An ancestor raised an exception (TypeError): ",
          "traceback": []
        }
      ],
      "console": []
    }
  ]
}